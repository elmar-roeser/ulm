<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>6</epicId>
    <storyId>2</storyId>
    <title>Display Model Selection UI</title>
    <status>drafted</status>
    <generatedAt>2025-11-21</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/6-2-display-model-selection-ui.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>user</asA>
    <iWant>to see available models with RAM requirements</iWant>
    <soThat>I can choose one suitable for my system</soThat>
    <tasks>
      <task id="1">Add sysinfo dependency (AC: 2)</task>
      <task id="2">Implement display_model_selection function (AC: 1, 3, 5)</task>
      <task id="3">Implement user input handling (AC: 4)</task>
      <task id="4">Unit tests</task>
      <task id="5">Verify build (AC: 6, 7)</task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">Display table with model name, RAM, speed rating, quality rating, [Installed] marker</criterion>
    <criterion id="2">Detect system RAM using sysinfo crate</criterion>
    <criterion id="3">Highlight recommended model based on detected RAM</criterion>
    <criterion id="4">User can select model with number key (1-4)</criterion>
    <criterion id="5">Return selected model index to caller</criterion>
    <criterion id="6">cargo build succeeds without errors</criterion>
    <criterion id="7">cargo clippy -- -D warnings passes</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/sprint-artifacts/tech-spec-epic-6.md" title="Tech Spec Epic 6" section="APIs and Interfaces" snippet="display_model_selection(models: &amp;[ModelInfo], system_ram_gb: f32) -> Result&lt;usize&gt;"/>
      <doc path="docs/architecture.md" title="Architecture" section="Project Structure" snippet="setup/ module structure"/>
      <doc path="docs/epics.md" title="Epics" section="Story 6.2" snippet="Simple terminal table, sysinfo crate for RAM detection"/>
    </docs>
    <code>
      <file path="src/setup/models.rs" kind="struct" symbol="RecommendedModel" lines="15-27" reason="Existing model struct with name, ram_gb, speed_rating, quality_rating, installed fields"/>
      <file path="src/setup/models.rs" kind="function" symbol="get_available_models" lines="116-142" reason="Returns Vec&lt;RecommendedModel&gt; - input for display function"/>
      <file path="src/setup/models.rs" kind="function" symbol="get_default_models" lines="65-96" reason="Creates default model list with metadata"/>
      <file path="src/setup/mod.rs" kind="module" symbol="" lines="" reason="Export display_model_selection and get_system_ram_gb here"/>
    </code>
    <dependencies>
      <rust>
        <package name="sysinfo" version="0.31" reason="System RAM detection - NEW dependency to add"/>
        <package name="anyhow" version="1" reason="Error handling with context"/>
      </rust>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="pattern">Simple terminal table output - no TUI/crossterm needed</constraint>
    <constraint type="pattern">Sync function using stdin for input</constraint>
    <constraint type="pattern">Use .context() from anyhow for all error chains</constraint>
    <constraint type="lint">Must pass cargo clippy -- -D warnings</constraint>
    <constraint type="lint">No unwrap_used or expect_used</constraint>
  </constraints>

  <interfaces>
    <interface name="RecommendedModel" kind="struct" signature="pub struct RecommendedModel { name: String, ram_gb: f32, speed_rating: u8, quality_rating: u8, installed: bool }" path="src/setup/models.rs"/>
    <interface name="display_model_selection" kind="function" signature="pub fn display_model_selection(models: &amp;[RecommendedModel], system_ram_gb: f32) -> Result&lt;usize&gt;" path="src/setup/models.rs"/>
    <interface name="get_system_ram_gb" kind="function" signature="pub fn get_system_ram_gb() -> f32" path="src/setup/models.rs"/>
  </interfaces>

  <tests>
    <standards>
      Tests use #[tokio::test] for async tests and standard #[test] for sync tests.
      Follow existing test patterns in setup/models.rs.
      Target 80% code coverage.
      Use assert! and assert_eq! macros.
      Tests at bottom of file in #[cfg(test)] module.
    </standards>
    <locations>
      <location>src/setup/models.rs (unit tests in #[cfg(test)] module)</location>
    </locations>
    <ideas>
      <idea ac="1">Test table formatting output contains all columns</idea>
      <idea ac="2">Test get_system_ram_gb returns reasonable value (> 0)</idea>
      <idea ac="3">Test recommendation logic for different RAM values</idea>
      <idea ac="4">Test input validation rejects invalid numbers</idea>
      <idea ac="5">Test function returns correct index for selection</idea>
    </ideas>
  </tests>

  <keyInsight>
    Story 6.1 already created RecommendedModel struct and get_available_models() function.
    This story adds the UI layer: display_model_selection() for terminal output and get_system_ram_gb() for RAM detection.
    Recommendation logic: >= 8GB → llama3.1:8b, >= 6GB → mistral:7b, >= 4GB → llama3.2:3b, else phi3:mini.
    Use star ratings (★★★★★) for visual speed/quality display.
  </keyInsight>
</story-context>
